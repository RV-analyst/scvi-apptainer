Bootstrap: docker
From: pytorch/pytorch:2.3.1-cuda12.1-cudnn8-runtime

%labels
    Maintainer gchoudha@brown.edu
    Description Torch-only Scanpy + scVI (GPU) for CCV

%post
    %post
    set -eux
    apt-get update
    apt-get install -y --no-install-recommends python3-pip python3-dev git ca-certificates
    # apt-get install -y --no-install-recommends build-essential  # only if needed

    python3 -m pip install --upgrade pip wheel setuptools

    python3 -m pip install --no-cache-dir --prefer-binary \
        scanpy==1.10.3 \
        scvi-tools==1.1.5 \
        anndata==0.10.9 \
        pandas==2.2.3 \
        numpy==1.26.4 \
        scikit-learn==1.5.2 \
        umap-learn==0.5.6 \
        matplotlib==3.9.2 \
        seaborn==0.13.2 \
        plotly==5.24.1 \
        jupyterlab==4.2.5 \
        session-info==1.0.0

    # sanity: confirm torch is still the base image version
    python3 - <<'PY'
import torch; print("Torch:", torch.__version__)
PY

    python3 -m pip cache purge || true
    rm -rf /root/.cache/pip
    apt-get clean
    rm -rf /var/lib/apt/lists/*

%environment
    export LC_ALL=C.UTF-8
    export LANG=C.UTF-8
    export MPLBACKEND=Agg
    export SCVI_BACKEND=PYTORCH

%runscript
    exec jupyter lab --ip=0.0.0.0 --port=8888 --no-browser


